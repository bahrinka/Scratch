SELECT
  REGEXP_SUBSTR(k.name, '[^/]+', 2) AS db_name,
  f.type AS file_type,
  ROUND(SUM(f.bytes) / 1024 / 1024 / 1024, 2) AS total_size_gb,
  COUNT(*) AS file_count
FROM
  v$asm_file f
JOIN
  x$kfalias k
  ON f.group_number = k.group_kfbh AND f.file_number = k.number_kfafh
WHERE
  k.name LIKE '+%'  -- Only include fully qualified ASM paths
  AND REGEXP_SUBSTR(k.name, '[^/]+', 2) IS NOT NULL
GROUP BY
  REGEXP_SUBSTR(k.name, '[^/]+', 2), f.type
ORDER BY
  total_size_gb DESC;
